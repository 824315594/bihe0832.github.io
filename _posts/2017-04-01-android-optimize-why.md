---
layout: post
title: Android安装包精简系列之为什么要优化精简安装包
category: 终端开发
tags: Android apk
keywords: Android 安装包 精简
description: 
---

### 写在前面

这篇文章是应用安装包优化相关的第二篇，这里主要总结一下为什么要优化精简安装包，包括为什么安卓包越来越大和精简优化安装包有哪些好处和弊端。

### 为什么apk越来越大

不管是平时的使用过程中，还是业务的数据监测，都可以感觉到目前单款应用的安装包已经越来越大，是什么原因导致这些问题呢？感觉主要是几个方面：

#### 设备硬件性能提升

终端手机的硬件性能提升是非常明显的，甚至更新的速度比摩尔定律预测的还要快，这里与安装包主要包括：

- 更大更好的屏幕、更快的绘制速度

	由于屏幕越来越大，而且分辨率越来越高，加上处理速度的提升，为了更用户更好的体验，在终端开发中越来越多的人使用高分辨率，效果更好的图片和其他资源。

- 设备类型增加

	由于硬件的蓬勃发展和不断更新，为了更快的计算速度，CPU的更新速度也越来越快，目前主流的CPU类型包括arm和x86相关的多个系列，为了更好地兼容设备指令集，带来更好的运算效果，很多开发者需要apk同时兼容多种指令集类型，这也导致了安装包的增加。

#### Android开发技术越来越成熟

- 第三方扩展库越来越多

	随着开源社区的成熟和Android相关的技术方案的沉淀，目前对于网络请求、数据库、文件操作、图片加载、UI控件(各种view，进度条、dialog等等)等这种只要`比较通用的技术基本上都已经有各种成熟的框架和扩展库，很多开发者在开发中不考虑性价比，为了实现一些很小的功能为了开发的便捷就引入各种框架`，因此导致项目代码中存在大量第三方库相关的内容，导致安装包不断增加。

- 开发框架越来越多

	同样因为相关技术的成熟，目前对于Android开发的整体框架也越来越多，例如MVP、MVVM等等，再加上国内特殊环境下热修复、动态加载等技术的大行其道，很多开发者同样不考虑性价比，无论什么类型的应用，都是各种能力均完全具备，做大做全或者使用很复杂的框架导致安装包不断增加。

#### Android碎片化越来越严重

Android的开放带来了Android的繁荣，但是也带来了非常严重的碎片化的问题，主要表现在

- 厂商太多、os版本太多、更新太慢

	截止目前，Android 8已经发布了开发者预览版，但是目前市面上主要的Android版本还集中在Android 4.X ,使用Android N的比例更低。同时加上各大厂商的制定ROM，Android设备的碎片化问题格外严重，国内厂商为了厂商的利益做了很多并不友好的修改，导致很多开发者不得不对不同的厂商ROM以及Android的不同版本在代码程度上添加兼容，这部分兼容的逻辑也很重

- 分辨率太多

	除了操作系统的版本太多以为，Android碎片化更严重的就是分辨率了，Android的屏幕分辨率多到无法数清。为了解决不同屏幕下分辨率的问题，Android提供了对应的解决方案，但是带来的问题就是相同的资源，需要根据不同的分辨率准备很多套，也导致资源占用很多。

#### 产品功能的盲目添加

这个其实最容易理解，随着移动互联网的发展，目前成熟的超级app越来越多，很多开发者都希望自己的app能成为下一个超级app。在不知道怎么成为下一个超级app的时候，最简单的做法就是做一个百科的大而且全的app，最好能包罗万象。最后导致安装包不断变大，但是很多用户仅仅使用很少一部分功能。

### 精简应用的安装包会有什么好处

上面提了那么多导致安装包变大的原因，貌似基本上绝大部分都是为了提供更好的应用体验，那为什么还要精简安装包呢？

#### 提高下载转化率

安装包越小，用户下载所需要的时间越短，用户的下载安装转化率也就越高。一个100M的应用，用户即使点了下载一看这么大的包也会犹豫要不要下载，如果下载速度很慢也很容易放弃。一个10M的应用，用户点了如果用户还在犹豫要不要下的时候已经下载完了，安装体验的可能性就更高。
　　
#### 降低服务器带宽

一般如果应用的用户量不是特别大的时候不会很明显，当用户量达到一定级别，如果又没有灰度策略和通过应用市场发布的策略的话，每次版本更新就会出一个很高的下载高峰，这个时候带宽可能会很高，目前带宽都是按照峰值收费，这就会导致以为峰值毛刺承担比较高的成本。

#### 尽量降低用户的流量消耗

应用的安装和更新都需要经过网络将其下载，app越大，流量越多。虽然目前流量资费已经大大的降低，但是能节省还是帮用户节省一些比较好。

### 其他

#### 精简应用的安装包又会有什么弊端

精简应用的安装包的弊端取决于你使用了哪些精简安装包的策略，这些要具体问题具体分析，这部分内容我会在具体介绍具体的优化方案的时候介绍。

#### 我们项目在进行安装包精简时一些别的考量

在后面系列的文章中我会具体介绍各种安装包精简相关的方案，里面有些是我们使用的，有些我们并没有使用，但是一并汇总整理了。这里再增加个我们在安装包精简的时候的总的考虑，避免后面多次解释。`经过几年的发展，目前移动网络已经有了比较大的变化，不论是传输速度还是网络质量都有了很大的提升，而用户的流量也越来越多，对于流量的关心程度已经大大降低。`因此我们在进行安装包精简的时候会有部分内容是在使用的时候直接去CDN拉取后缓存下来，而不是放在安装包里面（具体的策略会在后面具体介绍）。




